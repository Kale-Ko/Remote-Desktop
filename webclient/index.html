<!DOCTYPE html>
<html lang="en-US">

<head>
    <title>Remote Desktop</title>
</head>

<body>
    <script src="/Packet.js"></script>
    <script>
        const server = new WebSocket("{origin}/")

        server.addEventListener("open", event => {
            console.log("Connection opened")

            server.send(new Packet("connectionrequest").encode())
        })

        server.addEventListener("message", event => {
            var message = Packet.decode(event.data)

            if (message.type == "connectionaccepted") console.log("Connection accepted")
            else if (message.type == "display") {
                if (document.getElementById("display" + message.data.id) != null) document.getElementById("display" + message.data.id).setAttribute("src", URL.createObjectURL(new Blob([new Uint8Array(message.data.image.data)], { type: 'image/jpg' })))
                else {
                    var image = document.createElement("img")
                    image.id = "display" + message.data.id
                    document.body.appendChild(image)
                }
            }
        })

        server.addEventListener("close", event => {
            console.log("Connection closed")
        })
    </script>
</body>

</html>